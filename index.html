<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Premium Horse Catalogue</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --burgundy: #7B2240;
      --navy: #1B3A6B;
      --cream: #F5F1E8;
      --tan: #D4C5A9;
      --dark-burgundy: #5A1830;
      --light-cream: #FDFBF7;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Montserrat', sans-serif;
      background: var(--light-cream);
      color: var(--navy);
      line-height: 1.6;
      overflow-x: hidden;
    }

    .hero {
      background: linear-gradient(135deg, var(--burgundy) 0%, var(--navy) 100%);
      color: var(--cream);
      padding: 60px 20px 60px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .hero::before {
      content: '';
      position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background:
        radial-gradient(circle at 20% 50%, rgba(212, 197, 169, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(212, 197, 169, 0.1) 0%, transparent 50%);
      pointer-events: none;
    }

    .logo-container { margin-bottom: 20px; position: relative; }
    .logo { width: 150px; height: 150px; margin: 0 auto; animation: fadeIn 0.8s ease-out; }

    .hero h1 {
      font-family: 'Playfair Display', serif;
      font-size: 3.5rem;
      font-weight: 700;
      letter-spacing: 2px;
      margin-bottom: 15px;
      position: relative;
      animation: fadeInDown 0.8s ease-out;
      color: var(--cream);
    }

    .hero p {
      font-size: 1.1rem;
      font-weight: 300;
      letter-spacing: 1px;
      opacity: 0.9;
      position: relative;
      animation: fadeInUp 0.8s ease-out 0.2s backwards;
    }

    .container { max-width: 1400px; margin: 0 auto; padding: 60px 20px; }

    .horses-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 30px;
      margin-bottom: 40px;
    }

    .horse-card {
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      position: relative;
      animation: fadeIn 0.6s ease-out backwards;
    }

    .horse-card:nth-child(1) { animation-delay: 0.1s; }
    .horse-card:nth-child(2) { animation-delay: 0.2s; }
    .horse-card:nth-child(3) { animation-delay: 0.3s; }
    .horse-card:nth-child(4) { animation-delay: 0.4s; }
    .horse-card:nth-child(5) { animation-delay: 0.5s; }
    .horse-card:nth-child(6) { animation-delay: 0.6s; }

    .horse-card:hover { transform: translateY(-8px); box-shadow: 0 12px 40px rgba(0,0,0,0.15); }

    .horse-card::before {
      content: '';
      position: absolute; top: 0; left: 0; right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--burgundy), var(--navy));
      transform: scaleX(0);
      transition: transform 0.4s ease;
      transform-origin: left;
    }

    .horse-card:hover::before { transform: scaleX(1); }

    .horse-image-placeholder {
      height: 240px;
      background: linear-gradient(135deg, var(--tan) 0%, var(--burgundy) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      color: white;
      font-family: 'Playfair Display', serif;
    }

    .horse-info { padding: 25px; }

    .horse-name {
      font-family: 'Playfair Display', serif;
      font-size: 1.8rem;
      font-weight: 600;
      color: var(--navy);
      margin-bottom: 12px;
    }

    .horse-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 15px;
    }

    .horse-experience {
      font-size: 0.9rem;
      color: var(--navy);
      line-height: 1.5;
      margin-bottom: 15px;
      padding-top: 12px;
      border-top: 1px solid var(--tan);
    }

    .detail-item { display: flex; flex-direction: column; }

    .detail-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--burgundy);
      font-weight: 500;
      margin-bottom: 3px;
    }

    .detail-value { font-size: 1rem; color: var(--navy); font-weight: 500; }

    .horse-price {
      background: var(--burgundy);
      color: white;
      padding: 12px 20px;
      margin: 15px -25px -25px;
      text-align: center;
      font-size: 1.3rem;
      font-weight: 600;
      letter-spacing: 1px;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.85);
      z-index: 1000;
      overflow-y: auto;
      animation: fadeIn 0.3s ease-out;
    }

    .modal.active {
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 40px 20px;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      max-width: 900px;
      width: 100%;
      position: relative;
      animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      margin: auto;
    }

    .modal-header {
      background: linear-gradient(135deg, var(--burgundy) 0%, var(--navy) 100%);
      color: var(--cream);
      padding: 40px;
      border-radius: 12px 12px 0 0;
      position: relative;
    }

    .close-modal {
      position: absolute; top: 20px; right: 20px;
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      font-size: 2rem;
      width: 45px; height: 45px;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      line-height: 1;
    }

    .close-modal:hover { background: rgba(255,255,255,0.3); transform: rotate(90deg); }

    .modal-horse-name {
      font-family: 'Playfair Display', serif;
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .modal-basic-info { display: flex; gap: 25px; font-size: 1.1rem; opacity: 0.95; }
    .modal-body { padding: 40px; }

    .info-section { margin-bottom: 35px; }
    .info-section h3 {
      font-family: 'Playfair Display', serif;
      font-size: 1.5rem;
      color: var(--burgundy);
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--tan);
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .info-item {
      background: var(--light-cream);
      padding: 15px;
      border-radius: 6px;
      border-left: 3px solid var(--burgundy);
    }

    .info-item-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--burgundy);
      margin-bottom: 5px;
      font-weight: 500;
    }

    .info-item-value { font-size: 1.1rem; color: var(--navy); font-weight: 500; }

    .video-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .video-embed {
      position: relative;
      padding-bottom: 56.25%;
      height: 0;
      overflow: hidden;
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .video-embed iframe {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      border: none;
      border-radius: 8px;
    }

    .video-title { font-size: 0.9rem; margin-bottom: 10px; font-weight: 500; }

    /* ✅ Carousel wrapper with arrows + drag-to-scroll */
    .gallery-wrapper {
      position: relative;
      margin-top: 18px;
    }

    .image-gallery {
      display: flex;
      gap: 14px;
      overflow-x: auto;
      overflow-y: hidden;
      padding: 6px 44px 12px; /* room for arrows */
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
      scrollbar-gutter: stable;
      max-width: 100%;
      cursor: grab;
      user-select: none;
    }

    .image-gallery.dragging {
      cursor: grabbing;
    }

    .image-gallery::-webkit-scrollbar { height: 8px; }
    .image-gallery::-webkit-scrollbar-thumb {
      background: rgba(0,0,0,0.2);
      border-radius: 4px;
    }

    .gallery-image {
      flex: 0 0 auto;
      width: 260px;
      height: 200px;
      object-fit: cover;
      border-radius: 8px;
      scroll-snap-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: transform 0.25s ease;
      pointer-events: auto;
    }

    .gallery-image:hover { transform: scale(1.03); }

    .gallery-arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      background: rgba(27, 58, 107, 0.92);
      color: white;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 6px 18px rgba(0,0,0,0.22);
      z-index: 2;
    }

    .gallery-arrow:hover {
      background: rgba(123, 34, 64, 0.95);
    }

    .gallery-arrow.left { left: 8px; }
    .gallery-arrow.right { right: 8px; }

    .notes-box {
      background: var(--light-cream);
      padding: 20px;
      border-radius: 6px;
      border-left: 4px solid var(--navy);
      margin-top: 15px;
      line-height: 1.8;
    }

    .cost-breakdown {
      background: linear-gradient(135deg, var(--burgundy) 0%, var(--navy) 100%);
      color: white;
      padding: 30px;
      border-radius: 8px;
      margin-top: 20px;
    }

    .cost-row {
      display: flex;
      justify-content: space-between;
      gap: 16px;
      padding: 12px 0;
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }

    .cost-row:last-child {
      border-bottom: none;
      font-size: 1.2rem;
      font-weight: 600;
      padding-top: 20px;
      margin-top: 10px;
      border-top: 2px solid var(--tan);
    }

    .record-link {
      display: inline-block;
      background: var(--burgundy);
      color: white;
      padding: 12px 30px;
      border-radius: 6px;
      text-decoration: none;
      font-weight: 500;
      margin-top: 15px;
      transition: all 0.3s ease;
    }

    .record-link:hover {
      background: var(--dark-burgundy);
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes fadeInDown { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes slideUp { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }

    @media (max-width: 768px) {
      .hero h1 { font-size: 2.5rem; }
      .horses-grid { grid-template-columns: 1fr; }
      .modal-content { margin: 20px; }
      .modal-body { padding: 25px; }
      .info-grid { grid-template-columns: 1fr; }
      .gallery-image { width: 220px; height: 170px; }
    }
  </style>
</head>

<body>
  <div class="hero">
    <div class="logo-container">
      <img src="durango_logo.png" alt="Durango Farms" class="logo">
    </div>
    <h1>Premium Horse Catalogue</h1>
    <p>Exceptional Prospects for Discerning Riders</p>
  </div>

  <div class="container">
    <div class="horses-grid" id="horsesGrid"></div>
  </div>

  <div class="modal" id="horseModal">
    <div class="modal-content">
      <div class="modal-header">
        <button class="close-modal" onclick="closeModal()">&times;</button>
        <h2 class="modal-horse-name" id="modalHorseName"></h2>
        <div class="modal-basic-info" id="modalBasicInfo"></div>
      </div>
      <div class="modal-body" id="modalBody"></div>
    </div>
  </div>

  <script>
    const roiTargets = { 3: 0.20, 6: 0.12 };

    const exchangeRates = { EUR: 1.17, GBP: 1.27, USD: 1.00 };

    async function updateExchangeRates() {
      try {
        const response = await fetch('https://v6.exchangerate-api.com/v6/5291ccc35d8f81cceaf1fb15/latest/USD');
        const data = await response.json();
        if (data.result === 'success') {
          exchangeRates.EUR = 1 / data.conversion_rates.EUR;
          exchangeRates.GBP = 1 / data.conversion_rates.GBP;
          init();
        }
      } catch (e) {
        console.log('Using default exchange rates');
      }
    }

    const defaultMonthlyCosts = {
      board: 1500,
      insurance: 350,
      shows: 2000,
      shoeing: 350
    };

    const horses = [
      {
        name: "Ridge Douglas Lady",
        gender: "Mare",
        age: 10,
        currency: "EUR",
        price: 80000,
        insurance: 300,
        sellerCommission: 0.10,
        expectedResale: { usd: 180000 },
        experience: "1.35m FEI Young Riders; 1.40m National GP",
        location: "Ireland",
        cardImage: "WhatsApp Image 2026-02-03 at 3.34.06 AM (2).jpeg",
        galleryImages: [
          "RidgeDouglasLady_Pic_1.jpg",
          "RidgeDouglasLAdy_Breeding.jpg",
          "WhatsApp Image 2026-02-03 at 3.34.09 AM.jpeg",
          "WhatsApp Image 2026-02-03 at 3.34.10 AM (1).jpeg",
          "WhatsApp Image 2026-02-03 at 3.34.06 AM.jpeg",
          "WhatsApp Image 2026-02-03 at 3.34.06 AM (1).jpeg",
          "WhatsApp Image 2026-02-03 at 3.34.06 AM (2).jpeg",
          "WhatsApp Image 2026-02-03 at 3.34.07 AM (2).jpeg"
        ],
        videos: [
          { title: "Video 1", url: "https://youtu.be/OJ2VYij375Y" },
          { title: "Video 2", url: "https://youtu.be/bFE4BdW6x6M" },
          { title: "Competition Video 1", url: "https://youtu.be/hw_Zm3JcVQM" },
          { title: "Competition Video 2", url: "https://youtu.be/u4TqKN0CTDc" }
        ],
        notes: "Owned by breeder since foal with no soundness or health issues. Successfully competed at 1.35m FEI Young Riders level. Currently competing at 1.40m national GP level. Achievemnts include 2nd place finish in a 1.40 Grand Prix and multiple 1.20-1.35 wins. Clean history and record with original owners.",
        importCosts: {
          vetting:   { amount: 640,  currency: "EUR" },
          transport: { amount: 9100, currency: "EUR" },
          quarantine:{ amount: 10000,currency: "USD" },
          tariffs:   { amount: 3000, currency: "USD" }
        }
      },

      {
        name: "Ridge Douglas Lady 2",
        gender: "Mare",
        age: 10,
        currency: "EUR",
        price: 85000,
        insurance: 350,
        sellerCommission: 0.10,
        expectedResale: { usd: 185000 },
        experience: "1.35m FEI Young Riders; 1.40m National GP",
        location: "Ireland",
        cardImage: "WhatsApp Image 2026-02-03 at 3.34.06 AM (2).jpeg",
        galleryImages: [
          "RidgeDouglasLady_Pic_1.jpg",
          "RidgeDouglasLAdy_Breeding.jpg",
          "WhatsApp Image 2026-02-03 at 3.34.09 AM.jpeg",
          "WhatsApp Image 2026-02-03 at 3.34.10 AM (1).jpeg",
          "WhatsApp Image 2026-02-03 at 3.34.06 AM.jpeg",
          "WhatsApp Image 2026-02-03 at 3.34.06 AM (1).jpeg",
          "WhatsApp Image 2026-02-03 at 3.34.06 AM (2).jpeg",
          "WhatsApp Image 2026-02-03 at 3.34.07 AM (2).jpeg"
        ],
        videos: [
          { title: "Video 1", url: "https://youtu.be/OJ2VYij375Y" },
          { title: "Video 2", url: "https://youtu.be/bFE4BdW6x6M" },
          { title: "Competition Video 1", url: "https://youtu.be/hw_Zm3JcVQM" },
          { title: "Competition Video 2", url: "https://youtu.be/u4TqKN0CTDc" }
        ],
        notes: notes: "Owned by breeder since foal with no soundness or health issues. Successfully competed at 1.35m FEI Young Riders level. Currently competing at 1.40m national GP level. Achievemnts include 2nd place finish in a 1.40 Grand Prix and multiple 1.20-1.35 wins. Clean history and record with original owners.",
        importCosts: {
          vetting:   { amount: 640,  currency: "EUR" },
          transport: { amount: 9100, currency: "EUR" },
          quarantine:{ amount: 10000,currency: "USD" },
          tariffs:   { amount: 3000, currency: "USD" }
        }
      },

      {
        name: "Ridge Douglas Lady 3",
        gender: "Mare",
        age: 10,
        currency: "EUR",
        price: 90000,
        insurance: 400,
        sellerCommission: 0.10,
        expectedResale: { usd: 200000 },
        experience: "1.35m FEI Young Riders; 1.40m National GP",
        location: "Ireland",
        cardImage: "WhatsApp Image 2026-02-03 at 3.34.06 AM (2).jpeg",
        galleryImages: [
          "RidgeDouglasLady_Pic_1.jpg",
          "RidgeDouglasLAdy_Breeding.jpg",
          "WhatsApp Image 2026-02-03 at 3.34.09 AM.jpeg",
          "WhatsApp Image 2026-02-03 at 3.34.10 AM (1).jpeg",
          "WhatsApp Image 2026-02-03 at 3.34.06 AM.jpeg",
          "WhatsApp Image 2026-02-03 at 3.34.06 AM (1).jpeg",
          "WhatsApp Image 2026-02-03 at 3.34.06 AM (2).jpeg",
          "WhatsApp Image 2026-02-03 at 3.34.07 AM (2).jpeg"
        ],
        videos: [
          { title: "Video 1", url: "https://youtu.be/OJ2VYij375Y" },
          { title: "Video 2", url: "https://youtu.be/bFE4BdW6x6M" },
          { title: "Competition Video 1", url: "https://youtu.be/hw_Zm3JcVQM" },
          { title: "Competition Video 2", url: "https://youtu.be/u4TqKN0CTDc" }
        ],
        notes: notes: "Owned by breeder since foal with no soundness or health issues. Successfully competed at 1.35m FEI Young Riders level. Currently competing at 1.40m national GP level. Achievemnts include 2nd place finish in a 1.40 Grand Prix and multiple 1.20-1.35 wins. Clean history and record with original owners.",
        importCosts: {
          vetting:   { amount: 640,  currency: "EUR" },
          transport: { amount: 9100, currency: "EUR" },
          quarantine:{ amount: 10000,currency: "USD" },
          tariffs:   { amount: 3000, currency: "USD" }
        }
      },

      {
        name: "Million Rose",
        gender: "Mare",
        age: 8,
        currency: "EUR",
        price: 100000,
        insurance: 350,
        sellerCommission: 0.10,
        expectedResale: { usd: 225000 },
        experience: "1.35m FEI 1* Grand Prix",
        location: "Hungary",
        cardImage: "MillionRose_Pic_1.jpeg",
        galleryImages: [
          "MillionRose_Pic_1.jpeg",
          "MillionRose_Pic_2.jpeg",
          "MillionRose_Pic_3.jpeg",
          "MilionRose_Breeding.jpeg"
        ],
        videos: [
          { title: "Video 1", url: "https://youtu.be/CcDjJkBSiCM" },
          { title: "Video 2", url: "https://youtu.be/M35jt9HUDEE" }
        ],
        notes: "NOTE**Owner is asking 125k EUR but we are in negotiations to see if we can agree on 100k EUR**Extremely easy and straightforward ride with scope and talent, very sweet and good minded young horse. No quirks. Excellent breeding.",
        importCosts: {
          vetting:   { amount: 640,  currency: "EUR" },
          transport: { amount: 9100, currency: "EUR" },
          quarantine:{ amount: 10000,currency: "USD" },
          tariffs:   { amount: 3000, currency: "USD" }
        }
      }
    ];

    function toUSD(amount, currency) { return amount * exchangeRates[currency]; }

    function formatCurrency(amount, currency) {
      const symbols = { EUR: '€', GBP: '£', USD: '$' };
      return `${symbols[currency]}${Number(amount).toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}`;
    }

    function formatPriceDisplay(amount, currency) {
      if (currency === 'USD') return formatCurrency(amount, currency);
      const usdAmount = toUSD(amount, currency);
      return `${formatCurrency(amount, currency)} (~${formatCurrency(usdAmount, 'USD')})`;
    }

    function calculateTotalImportCosts(horse) {
      const basePrice = toUSD(horse.price, horse.currency);
      const vetting = toUSD(horse.importCosts.vetting.amount, horse.importCosts.vetting.currency);
      const transport = toUSD(horse.importCosts.transport.amount, horse.importCosts.transport.currency);
      const quarantine = toUSD(horse.importCosts.quarantine.amount, horse.importCosts.quarantine.currency);
      const tariffs = toUSD(horse.importCosts.tariffs.amount, horse.importCosts.tariffs.currency);

      return { basePrice, vetting, transport, quarantine, tariffs, totalInitial: basePrice + vetting + transport + quarantine + tariffs };
    }

    function calculateHoldingCosts(horse, months) {
      const monthlyExpenses = defaultMonthlyCosts.board + horse.insurance + defaultMonthlyCosts.shows;
      let shoeingCosts = 0;
      const shoeingMonths = [1, 2, 4, 5, 7, 8, 10, 11, 13, 14, 16, 17, 19, 20, 22, 23];
      for (let month = 1; month <= Math.ceil(months); month++) if (shoeingMonths.includes(month)) shoeingCosts += defaultMonthlyCosts.shoeing;
      return { monthlyExpenses, shoeingCosts, totalHolding: (monthlyExpenses * months) + shoeingCosts };
    }

    function calculateROIWithResale(horse, months, resalePriceUSD) {
      const costs = calculateTotalImportCosts(horse);
      const holding = calculateHoldingCosts(horse, months);
      const totalInvestment = costs.totalInitial + holding.totalHolding;

      const sellerCommissionAmount = resalePriceUSD * horse.sellerCommission;
      const netProceeds = resalePriceUSD - sellerCommissionAmount;

      const profit = netProceeds - totalInvestment;
      const roiPercent = (profit / totalInvestment) * 100;

      return { totalInvestment, netProceeds, profit, roiPercent };
    }

    function requiredResalePriceForTargetROI(horse, months, targetROI) {
      const costs = calculateTotalImportCosts(horse);
      const holding = calculateHoldingCosts(horse, months);
      const totalInvestment = costs.totalInitial + holding.totalHolding;
      const requiredNetProceeds = totalInvestment * (1 + targetROI);
      const requiredResale = requiredNetProceeds / (1 - horse.sellerCommission);
      return { requiredResale };
    }

    function createHorseCard(horse, index) {
      const card = document.createElement('div');
      card.className = 'horse-card';
      card.onclick = () => openModal(index);

      const priceDisplay = formatPriceDisplay(horse.price, horse.currency);
      const imageHtml = horse.cardImage
        ? `<img src="${horse.cardImage}" alt="${horse.name}" style="width: 100%; height: 240px; object-fit: cover;">`
        : `<div class="horse-image-placeholder">${horse.name.charAt(0)}</div>`;

      card.innerHTML = `
        ${imageHtml}
        <div class="horse-info">
          <h3 class="horse-name">${horse.name}</h3>
          <div class="horse-details">
            <div class="detail-item"><span class="detail-label">Gender</span><span class="detail-value">${horse.gender}</span></div>
            <div class="detail-item"><span class="detail-label">Age</span><span class="detail-value">${horse.age} years</span></div>
          </div>
          <div class="horse-experience">${horse.experience}</div>
          <div class="horse-price">${priceDisplay}</div>
        </div>
      `;
      return card;
    }

    function attachGalleryInteractions(wrapperEl) {
      const gallery = wrapperEl.querySelector('.image-gallery');
      const leftBtn = wrapperEl.querySelector('.gallery-arrow.left');
      const rightBtn = wrapperEl.querySelector('.gallery-arrow.right');

      // Buttons scroll
      const scrollByAmount = () => Math.max(260 + 14, Math.floor(gallery.clientWidth * 0.8));
      leftBtn.addEventListener('click', (e) => { e.stopPropagation(); gallery.scrollBy({ left: -scrollByAmount(), behavior: 'smooth' }); });
      rightBtn.addEventListener('click', (e) => { e.stopPropagation(); gallery.scrollBy({ left: scrollByAmount(), behavior: 'smooth' }); });

      // Drag to scroll (desktop)
      let isDown = false;
      let startX = 0;
      let startScrollLeft = 0;
      let moved = false;

      gallery.addEventListener('pointerdown', (e) => {
        isDown = true;
        moved = false;
        gallery.classList.add('dragging');
        startX = e.clientX;
        startScrollLeft = gallery.scrollLeft;
        gallery.setPointerCapture(e.pointerId);
      });

      gallery.addEventListener('pointermove', (e) => {
        if (!isDown) return;
        const dx = e.clientX - startX;
        if (Math.abs(dx) > 6) moved = true;
        gallery.scrollLeft = startScrollLeft - dx;
      });

      const end = () => {
        isDown = false;
        gallery.classList.remove('dragging');
      };

      gallery.addEventListener('pointerup', end);
      gallery.addEventListener('pointercancel', end);

      // Click to open image (but ignore if dragged)
      gallery.querySelectorAll('img.gallery-image').forEach(img => {
        img.addEventListener('click', (e) => {
          e.stopPropagation();
          if (moved) return; // ignore click if user dragged
          const url = img.getAttribute('data-full');
          window.open(url, '_blank');
        });
      });
    }

    function openModal(index) {
      const horse = horses[index];
      const modal = document.getElementById('horseModal');

      const priceDisplay = formatPriceDisplay(horse.price, horse.currency);
      const expectedResaleUSD = horse.expectedResale?.usd || 0;

      const roi3 = calculateROIWithResale(horse, 3, expectedResaleUSD);
      const roi6 = calculateROIWithResale(horse, 6, expectedResaleUSD);

      const req3 = requiredResalePriceForTargetROI(horse, 3, roiTargets[3]);
      const req6 = requiredResalePriceForTargetROI(horse, 6, roiTargets[6]);

      document.getElementById('modalHorseName').textContent = horse.name;
      document.getElementById('modalBasicInfo').innerHTML = `
        <span>${horse.gender}</span><span>•</span><span>${horse.age} years old</span><span>•</span><span>${priceDisplay}</span>
      `;

      function getYouTubeEmbedUrl(url) {
        const videoId = url.includes('youtu.be')
          ? url.split('youtu.be/')[1].split('?')[0]
          : url.split('v=')[1]?.split('&')[0];
        return videoId ? `https://www.youtube.com/embed/${videoId}` : null;
      }

      document.getElementById('modalBody').innerHTML = `
        ${horse.galleryImages?.length ? `
          <div class="info-section">
            <h3>Photos</h3>
            <div class="gallery-wrapper" data-gallery="1">
              <button class="gallery-arrow left" aria-label="Scroll left">‹</button>
              <div class="image-gallery">
                ${horse.galleryImages.map(u => `
                  <img src="${u}" data-full="${u}" alt="${horse.name}" class="gallery-image">
                `).join('')}
              </div>
              <button class="gallery-arrow right" aria-label="Scroll right">›</button>
            </div>
            <p style="font-size:0.85rem; opacity:0.8; margin-top:8px;">
              Tip: drag to scroll, or use arrows.
            </p>
          </div>
        ` : ''}

        <div class="info-section">
          <h3>Details</h3>
          <div class="info-grid">
            <div class="info-item">
              <div class="info-item-label">Experience</div>
              <div class="info-item-value">${horse.experience}</div>
            </div>
            <div class="info-item">
              <div class="info-item-label">Location</div>
              <div class="info-item-value">${horse.location}</div>
            </div>
          </div>
        </div>

        ${horse.videos?.length ? `
          <div class="info-section">
            <h3>Videos</h3>
            <div class="video-container">
              ${horse.videos.map(v => {
                const embedUrl = getYouTubeEmbedUrl(v.url);
                return embedUrl ? `
                  <div>
                    <div class="video-title">${v.title}</div>
                    <div class="video-embed"><iframe src="${embedUrl}" allowfullscreen></iframe></div>
                  </div>
                ` : `<a href="${v.url}" target="_blank" class="record-link">${v.title}</a>`;
              }).join('')}
            </div>
          </div>
        ` : ''}

        <div class="info-section">
          <h3>Notes</h3>
          <div class="notes-box">${horse.notes}</div>
        </div>

        <div class="info-section">
          <h3>Expected Resale Value & ROI</h3>
          <div class="cost-breakdown">
            <div class="cost-row"><span>Expected resale value</span><span><strong>${formatCurrency(expectedResaleUSD, 'USD')}</strong></span></div>
            <div class="cost-row"><span><strong>ROI if sold in 3 months</strong></span><span><strong>${roi3.roiPercent.toFixed(1)}%</strong></span></div>
            <div class="cost-row"><span><strong>ROI if sold in 6 months</strong></span><span><strong>${roi6.roiPercent.toFixed(1)}%</strong></span></div>
          </div>
        </div>

        <div class="info-section">
          <h3>Minimum Resale Value to Meet Expected ROI</h3>
          <p style="font-size: 0.9rem; opacity: 0.85; margin-bottom: 12px;">
            Investor targets: <strong>20% ROI at 3 months</strong> or <strong>12% ROI at 6 months</strong>
          </p>
          <div class="cost-breakdown">
            <div class="cost-row"><span>Minimum resale @ 3 months (20% ROI)</span><span><strong>${formatCurrency(req3.requiredResale, 'USD')}</strong></span></div>
            <div class="cost-row"><span>Minimum resale @ 6 months (12% ROI)</span><span><strong>${formatCurrency(req6.requiredResale, 'USD')}</strong></span></div>
          </div>
        </div>
      `;

      modal.classList.add('active');
      document.body.style.overflow = 'hidden';

      // Attach scrolling/drag behavior after HTML is injected
      const wrapper = document.querySelector('.gallery-wrapper');
      if (wrapper) attachGalleryInteractions(wrapper);
    }

    function closeModal() {
      const modal = document.getElementById('horseModal');
      modal.classList.remove('active');
      document.body.style.overflow = 'auto';
    }

    document.getElementById('horseModal').addEventListener('click', function(e) {
      if (e.target === this) closeModal();
    });

    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') closeModal();
    });

    function init() {
      const grid = document.getElementById('horsesGrid');
      grid.innerHTML = '';
      horses.forEach((horse, index) => grid.appendChild(createHorseCard(horse, index)));
    }

    updateExchangeRates().then(() => init()).catch(() => init());
  </script>
</body>
</html>
